[gd_scene format=3 uid="uid://cpq6v7yqk8y8j"]

[ext_resource type="Script" uid="uid://02kpb1kqm303" path="res://src/player/xr_player.gd" id="1_player"]
[ext_resource type="Script" uid="uid://3ir0c0htxlqh" path="res://src/player/xr_origin_3d.gd" id="2_xr_origin"]
[ext_resource type="Script" uid="uid://der68q68jhigr" path="res://src/player/physics_hand.gd" id="3_physics_hand"]
[ext_resource type="Material" uid="uid://dt14gsjdqu78t" path="res://world_grab_demo/ghost_hand.tres" id="3_yb8bw"]
[ext_resource type="Script" uid="uid://b0ncs507wux1w" path="res://src/player/desktop_controller.gd" id="4_desktop"]
[ext_resource type="Script" uid="uid://deum3u4irqnyx" path="res://src/objects/watch_compass.gd" id="5_watch"]
[ext_resource type="Script" uid="uid://u2otyj4gjtl2" path="res://src/player/hand_pointer.gd" id="6_pointer"]
[ext_resource type="Material" uid="uid://cl3ucly7cjhvy" path="res://assets/wireframe-material.tres" id="7_xe8se"]
[ext_resource type="Script" uid="uid://bndx0a4k0k8hw" path="res://src/systems/voxel_chunk_manager.gd" id="11_2d0bc"]
[ext_resource type="Script" uid="uid://dr821xg418lpi" path="res://src/player/components/player_movement_component.gd" id="12_movement"]
[ext_resource type="Script" uid="uid://dn1tnmxov46vk" path="res://src/systems/grid_painter.gd" id="13_grid_painter"]
[ext_resource type="Script" uid="uid://04sudajutma5" path="res://src/player/components/player_network_component.gd" id="14_network_comp"]
[ext_resource type="Script" uid="uid://cxk34sx374uym" path="res://src/player/components/player_voice_component.gd" id="15_voice_comp"]
[ext_resource type="Script" uid="uid://dwsx0otrybpmd" path="res://src/player/components/simple_world_grab_component.gd" id="16_simple_grab"]
[ext_resource type="Script" uid="uid://ni7m2frmfnh7" path="res://src/player/components/hand_movement_component.gd" id="17_hand_movement"]
[ext_resource type="Script" uid="uid://cdrcd8vcdgh73" path="res://src/player/components/desktop_interaction_component.gd" id="18_desktop_interaction"]
[ext_resource type="PackedScene" path="res://src/ui/WatchMenuViewport3D.tscn" id="18_watch_viewport"]

[sub_resource type="BoxMesh" id="BoxMesh_xxbg3"]
size = Vector3(0.3, 0.4, 0.2)

[sub_resource type="BoxMesh" id="BoxMesh_l588l"]
size = Vector3(0.22, 0.22, 0.22)

[sub_resource type="BoxShape3D" id="BoxShape3D_xxbg3"]

[sub_resource type="BoxMesh" id="BoxMesh_hand"]
material = ExtResource("3_yb8bw")
size = Vector3(0.1, 0.1, 0.1)

[sub_resource type="BoxMesh" id="BoxMesh_watch_face"]
size = Vector3(0.04, 0.004, 0.04)

[sub_resource type="BoxMesh" id="BoxMesh_watch_needle"]
size = Vector3(0.02, 0.002, 0.002)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_ray"]

[sub_resource type="SphereMesh" id="SphereMesh_watch_hit"]
radius = 0.015
height = 0.03

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_pointer_face"]
transparency = 1
albedo_color = Color(0.87, 0.24, 0.24, 0.85)

[sub_resource type="QuadMesh" id="QuadMesh_pointer_face"]
size = Vector2(0.04, 0.04)

[sub_resource type="CylinderMesh" id="CylinderMesh_pointer_hit"]
top_radius = 0.01
bottom_radius = 0.01
height = 0.001
radial_segments = 16

[sub_resource type="SphereShape3D" id="SphereShape3D_pe0gf"]

[sub_resource type="SphereMesh" id="SphereMesh_8w1hn"]

[sub_resource type="BoxShape3D" id="BoxShape3D_hand"]

[node name="XRPlayer6" type="Node3D" unique_id=1985006532]
script = ExtResource("1_player")
desktop_extra_collider_offset = Vector3(0, 0, 0)

[node name="BuildRoot" type="Node3D" parent="." unique_id=951936055]

[node name="PlayerBody" type="RigidBody3D" parent="." unique_id=939809904 groups=["player"]]
collision_layer = 2
axis_lock_angular_x = true
axis_lock_angular_y = true
axis_lock_angular_z = true
mass = 5.0
center_of_mass_mode = 1
center_of_mass = Vector3(0, -6.35, 0)

[node name="XROrigin3D" type="XROrigin3D" parent="PlayerBody" unique_id=593593922]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.618921, -0.180528)
script = ExtResource("2_xr_origin")

[node name="XRCamera3D" type="XRCamera3D" parent="PlayerBody/XROrigin3D" unique_id=678573024]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.03717, 0)

[node name="HeadArea" type="Area3D" parent="PlayerBody/XROrigin3D/XRCamera3D" unique_id=508713069 groups=["player"]]
collision_layer = 2

[node name="BodyMesh" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/XRCamera3D/HeadArea" unique_id=596586885]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.35, 0)
cast_shadow = 0
mesh = SubResource("BoxMesh_xxbg3")

[node name="HeadMesh" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/XRCamera3D/HeadArea" unique_id=396937068]
cast_shadow = 0
mesh = SubResource("BoxMesh_l588l")

[node name="HeadCollisionShape" type="CollisionShape3D" parent="PlayerBody/XROrigin3D/XRCamera3D/HeadArea" unique_id=346767088]
transform = Transform3D(0.23, 0, 0, 0, 0.23, 0, 0, 0, 0.23, 0, 0, 0)
shape = SubResource("BoxShape3D_xxbg3")

[node name="LeftController" type="XRController3D" parent="PlayerBody/XROrigin3D" unique_id=829066177]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.846876, 0, 0)
tracker = &"left_hand"
pose = &"grip"

[node name="OpenXRFbRenderModel" type="OpenXRFbRenderModel" parent="PlayerBody/XROrigin3D/LeftController" unique_id=642638939]

[node name="LeftHandMesh" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController" unique_id=2085390048]
cast_shadow = 0
mesh = SubResource("BoxMesh_hand")

[node name="Watch" type="Node3D" parent="PlayerBody/XROrigin3D/LeftController" unique_id=832495262]
transform = Transform3D(-2.94803e-08, -0.738337, 0.674431, -3.22737e-08, 0.674431, 0.738338, -0.999999, -2.12286e-22, -4.37114e-08, -0.0622383, 0.0441848, 0)
script = ExtResource("5_watch")
rotation_axis_local = Vector3(0, 1, 0)
ray_length = 1.0
show_line = false
show_hitpoint = false

[node name="UIViewportWatch" parent="PlayerBody/XROrigin3D/LeftController/Watch" unique_id=766114696 instance=ExtResource("18_watch_viewport")]
transform = Transform3D(0.12, 0, 0, 0, 0.055748, 0.106271, 0, -0.106271, 0.055748, 0, 0.058575, -0.118114)

[node name="WatchFace" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController/Watch" unique_id=1295475450]
cast_shadow = 0
mesh = SubResource("BoxMesh_watch_face")

[node name="Needle" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController/Watch" unique_id=473872773]
transform = Transform3D(0.02, 0, 0, 0, 0.002, 0, 0, 0, 0.002, 0, 0.00955808, 0)
visible = false
cast_shadow = 0
mesh = SubResource("BoxMesh_watch_needle")

[node name="RayCast" type="RayCast3D" parent="PlayerBody/XROrigin3D/LeftController/Watch" unique_id=2108499496]
target_position = Vector3(0, 1, 0)
collision_mask = 6
hit_from_inside = true
collide_with_areas = true

[node name="RayVisual" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController/Watch" unique_id=1939927490]
material_override = SubResource("StandardMaterial3D_ray")
cast_shadow = 0

[node name="RayHit" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController/Watch" unique_id=1095179302]
cast_shadow = 0
mesh = SubResource("SphereMesh_watch_hit")

[node name="RayCast3D" type="RayCast3D" parent="PlayerBody/XROrigin3D/LeftController" unique_id=762596766]
target_position = Vector3(0, 0, -10)
collision_mask = 4
collide_with_areas = true

[node name="HandPointer" type="Node3D" parent="PlayerBody/XROrigin3D/LeftController" unique_id=1391630202]
transform = Transform3D(1, 0, 0, 0, 0.57357645, 0.81915206, 0, -0.81915206, 0.57357645, 0, 0, 0)
script = ExtResource("6_pointer")
ray_length = 7.5
ray_length_min = 7.0
include_pointer_color = true
pointer_color = Color(0.568627, 1, 1, 1)
ray_visibility_mode = "on_hit_or_trigger"
hit_visibility_mode = "always"
hit_color = Color(0.6784314, 0.69411767, 1, 1)
hit_scale_per_meter = 0.5
hit_min_scale = 0.05
hit_max_scale = 1000000000.0
hit_scale_user_multiplier_min = 0.01
hit_scale_user_multiplier_max = 10.0

[node name="PointerFace" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController/HandPointer" unique_id=1064310651]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.07)
visible = false
material_override = SubResource("StandardMaterial3D_pointer_face")
cast_shadow = 0
mesh = SubResource("QuadMesh_pointer_face")

[node name="PointerRayCast" type="RayCast3D" parent="PlayerBody/XROrigin3D/LeftController/HandPointer" unique_id=1770878347]
target_position = Vector3(0, 0, -3.5)
collision_mask = 32
hit_from_inside = true
collide_with_areas = true

[node name="PointerRayVisual" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController/HandPointer" unique_id=422145121]
cast_shadow = 0

[node name="PointerRayHit" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/LeftController/HandPointer" unique_id=2032582587]
cast_shadow = 0
mesh = SubResource("CylinderMesh_pointer_hit")

[node name="RightController" type="XRController3D" parent="PlayerBody/XROrigin3D" unique_id=1759401453]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.549018, 0, 0)
tracker = &"right_hand"
pose = &"grip"

[node name="OpenXRFbRenderModel" type="OpenXRFbRenderModel" parent="PlayerBody/XROrigin3D/RightController" unique_id=817189998]
render_model_type = 1

[node name="RightHandMesh" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/RightController" unique_id=911480807]
cast_shadow = 0
mesh = SubResource("BoxMesh_hand")

[node name="HandPointer" type="Node3D" parent="PlayerBody/XROrigin3D/RightController" unique_id=492218641]
transform = Transform3D(1, 0, 0, 0, 0.57357645, 0.81915206, 0, -0.81915206, 0.57357645, 0, 0, 0)
script = ExtResource("6_pointer")
ray_length = 7.0
ray_length_min = 7.0
ray_length_max = 1000000.0
ray_visibility_mode = "on_hit_or_trigger"
hit_visibility_mode = "always"
hit_color = Color(0.73333335, 0.7372549, 1, 0.8862745)
hit_scale_per_meter = 0.5
hit_min_scale = 0.05
hit_max_scale = 1000000000.0
hit_scale_user_multiplier_min = 0.01
hit_scale_user_multiplier_max = 10.0

[node name="PointerFace" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/RightController/HandPointer" unique_id=611834496]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.07)
material_override = SubResource("StandardMaterial3D_pointer_face")
cast_shadow = 0
mesh = SubResource("QuadMesh_pointer_face")

[node name="PointerRayCast" type="RayCast3D" parent="PlayerBody/XROrigin3D/RightController/HandPointer" unique_id=42189760]
target_position = Vector3(0, 0, -3.5)
collision_mask = 32
hit_from_inside = true
collide_with_areas = true

[node name="PointerRayVisual" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/RightController/HandPointer" unique_id=273281057]
cast_shadow = 0

[node name="PointerRayHit" type="MeshInstance3D" parent="PlayerBody/XROrigin3D/RightController/HandPointer" unique_id=1202519073]
cast_shadow = 0
mesh = SubResource("CylinderMesh_pointer_hit")

[node name="RayCast3D" type="RayCast3D" parent="PlayerBody/XROrigin3D/RightController" unique_id=1242757362]
target_position = Vector3(0, 0, -10)
collision_mask = 4
collide_with_areas = true

[node name="LeftHandTracker" type="XRNode3D" parent="PlayerBody/XROrigin3D" unique_id=1319717165]
tracker = &"/user/hand_tracker/left"
show_when_tracked = true

[node name="OpenXRFbHandTrackingMesh" type="OpenXRFbHandTrackingMesh" parent="PlayerBody/XROrigin3D/LeftHandTracker" unique_id=1125184249]
material = ExtResource("7_xe8se")

[node name="XRHandModifier3D" type="XRHandModifier3D" parent="PlayerBody/XROrigin3D/LeftHandTracker/OpenXRFbHandTrackingMesh" unique_id=1498497738]

[node name="RightHandTracker" type="XRNode3D" parent="PlayerBody/XROrigin3D" unique_id=1278368324]
tracker = &"/user/hand_tracker/right"
show_when_tracked = true

[node name="OpenXRFbHandTrackingMesh" type="OpenXRFbHandTrackingMesh" parent="PlayerBody/XROrigin3D/RightHandTracker" unique_id=263602541]
hand = 1
material = ExtResource("7_xe8se")
bones/0/name = "RightPalm"
bones/1/name = "RightHand"
bones/2/name = "RightThumbMetacarpal"
bones/3/name = "RightThumbProximal"
bones/4/name = "RightThumbDistal"
bones/5/name = "RightThumbTip"
bones/6/name = "RightIndexMetacarpal"
bones/7/name = "RightIndexProximal"
bones/8/name = "RightIndexIntermediate"
bones/9/name = "RightIndexDistal"
bones/10/name = "RightIndexTip"
bones/11/name = "RightMiddleMetacarpal"
bones/12/name = "RightMiddleProximal"
bones/13/name = "RightMiddleIntermediate"
bones/14/name = "RightMiddleDistal"
bones/15/name = "RightMiddleTip"
bones/16/name = "RightRingMetacarpal"
bones/17/name = "RightRingProximal"
bones/18/name = "RightRingIntermediate"
bones/19/name = "RightRingDistal"
bones/20/name = "RightRingTip"
bones/21/name = "RightLittleMetacarpal"
bones/22/name = "RightLittleProximal"
bones/23/name = "RightLittleIntermediate"
bones/24/name = "RightLittleDistal"
bones/25/name = "RightLittleTip"

[node name="XRHandModifier3D" type="XRHandModifier3D" parent="PlayerBody/XROrigin3D/RightHandTracker/OpenXRFbHandTrackingMesh" unique_id=352943663]
hand_tracker = &"/user/hand_tracker/right"

[node name="DesktopCamera" type="Camera3D" parent="PlayerBody" unique_id=250281076]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.755936, 0)

[node name="CenterPointer" type="Node3D" parent="PlayerBody/DesktopCamera" unique_id=424202139]
script = ExtResource("6_pointer")
ray_length = 5.0
ray_length_min = 0.001
ray_length_max = 1000000.0
pointer_collision_mask = 33
include_pointer_color = true
hit_scale_user_multiplier_min = 0.01
hit_scale_user_multiplier_max = 10.0

[node name="PointerFace" type="MeshInstance3D" parent="PlayerBody/DesktopCamera/CenterPointer" unique_id=424887867]
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 0, 0, -0.07)
material_override = SubResource("StandardMaterial3D_pointer_face")
cast_shadow = 0
mesh = SubResource("QuadMesh_pointer_face")

[node name="PointerRayCast" type="RayCast3D" parent="PlayerBody/DesktopCamera/CenterPointer" unique_id=399327217]
target_position = Vector3(0, 0, -5)
collision_mask = 33
hit_from_inside = true
collide_with_areas = true

[node name="PointerRayVisual" type="MeshInstance3D" parent="PlayerBody/DesktopCamera/CenterPointer" unique_id=47473927]
cast_shadow = 0

[node name="PointerRayHit" type="MeshInstance3D" parent="PlayerBody/DesktopCamera/CenterPointer" unique_id=1002412688]
cast_shadow = 0
mesh = SubResource("CylinderMesh_pointer_hit")

[node name="DesktopController" type="Node" parent="PlayerBody" unique_id=1864759325]
script = ExtResource("4_desktop")

[node name="PhysicsHandLeft" type="RigidBody3D" parent="." unique_id=1837288581 node_paths=PackedStringArray("player_rigidbody", "target")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.801002, 0, 0)
collision_layer = 4
gravity_scale = 0.0
center_of_mass_mode = 1
contact_monitor = true
max_contacts_reported = 8
script = ExtResource("3_physics_hand")
rot_frequency = 3000.0
player_rigidbody = NodePath("../PlayerBody")
target = NodePath("../PlayerBody/XROrigin3D/LeftController")

[node name="CollisionShape3D" type="CollisionShape3D" parent="PhysicsHandLeft" unique_id=880726284]
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 0, 0, 0)
shape = SubResource("SphereShape3D_pe0gf")

[node name="PhysicsHandLeftMesh" type="MeshInstance3D" parent="PhysicsHandLeft" unique_id=1450919141]
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 0, 0, 0)
visible = false
cast_shadow = 0
mesh = SubResource("SphereMesh_8w1hn")

[node name="PhysicsHandRight" type="RigidBody3D" parent="." unique_id=526551679 node_paths=PackedStringArray("player_rigidbody", "target")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.541033, 0, 0)
collision_layer = 4
gravity_scale = 0.0
center_of_mass_mode = 1
contact_monitor = true
max_contacts_reported = 8
script = ExtResource("3_physics_hand")
player_rigidbody = NodePath("../PlayerBody")
target = NodePath("../PlayerBody/XROrigin3D/RightController")
controller_name = "right_hand"

[node name="CollisionShape3D" type="CollisionShape3D" parent="PhysicsHandRight" unique_id=305575214]
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 0, 0, 0)
shape = SubResource("BoxShape3D_hand")

[node name="PhysicsHandRightMesh" type="MeshInstance3D" parent="PhysicsHandRight" unique_id=2008929583]
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 0, 0, 0)
visible = false
cast_shadow = 0
mesh = SubResource("BoxMesh_hand")

[node name="PlayerMovementComponent" type="Node" parent="." unique_id=232556656]
script = ExtResource("12_movement")
turn_mode = 1
debug_world_grab_logs = false
enable_one_hand_world_grab = false
enable_one_hand_world_rotate = false
enable_one_hand_rotation = false
show_one_hand_grab_visual = false
auto_respawn_enabled = true
autojoin_enabled = true
v2_show_visual = false
enable_two_hand_grab_v3 = false
v3_show_visual = false

[node name="VoxelChunkManager" type="Node" parent="." unique_id=1325437584 groups=["voxel_manager"]]
script = ExtResource("11_2d0bc")

[node name="GridPainter" type="Node3D" parent="." unique_id=1302115314]
script = ExtResource("13_grid_painter")
player_root_path = NodePath("..")

[node name="PlayerNetworkComponent" type="Node" parent="." unique_id=1277471060]
script = ExtResource("14_network_comp")

[node name="PlayerVoiceComponent" type="Node" parent="." unique_id=948526531]
script = ExtResource("15_voice_comp")

[node name="SimpleWorldGrabComponent" type="Node" parent="." unique_id=739088080]
script = ExtResource("16_simple_grab")

[node name="HandMovementComponent" type="Node" parent="." unique_id=400687513]
script = ExtResource("17_hand_movement")
enabled = false

[node name="DesktopInteractionComponent" type="Node" parent="." unique_id=308251478]
script = ExtResource("18_desktop_interaction")
debug_logs = true
